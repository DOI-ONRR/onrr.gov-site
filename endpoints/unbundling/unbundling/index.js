"use strict";const e=require("node-fetch"),o=require("fs");console.log('"production": ',"production");const s="https://dev-onrr-cms.app.cloud.gov";console.log("press-release targetUrl ----------------------\x3e ",s);const n=async(s,n)=>{console.log("------------------------------------------------------------------------------------"),console.log("                                                                    "),console.log("url:  ",n),console.log("                                                                    "),console.log("------------------------------------------------------------------------------------");let t=((e,s)=>new Promise(((n,t)=>{const c=o.createWriteStream(s);e.pipe(c).on("finish",n).on("error",t)})))((await e(n)).body,s);return t};module.exports=(e,{services:o,exceptions:t})=>{const{ItemsService:c}=o,{ServiceUnavailableException:l}=t;e.get("/:file",((e,o,t)=>{const r=new c("directus_files",{schema:e.schema,accountability:e.accountability}),i=e.params.file;r.readByQuery({fields:["*"],filter:{filename_download:{_eq:i}}}).then((async e=>{console.log("unbundling results: ",e);const t=`/tmp/${i}`,c=`/assets/${e[0].id}`;return await n(t,`${s}${c}`),o.sendFile(t)})).catch((e=>t(new l(e.message))))}))};
