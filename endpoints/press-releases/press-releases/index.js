"use strict";const e=require("node-fetch"),s=require("fs");console.log("press-release targetUrl ----------------------\x3e ","https://dev-onrr-cms.app.cloud.gov");const o=async(o,t)=>{console.log("------------------------------------------------------------------------------------"),console.log("                                                                    "),console.log("url:  ",t),console.log("                                                                    "),console.log("------------------------------------------------------------------------------------");let l=((e,o)=>new Promise(((t,l)=>{const c=s.createWriteStream(o);e.pipe(c).on("finish",t).on("error",l)})))((await e(t)).body,o);return l};module.exports=(e,{services:s,exceptions:t})=>{const{ItemsService:l}=s,{ServiceUnavailableException:c}=t;e.get("/:file",((e,s,t)=>{const r=new l("directus_files",{schema:e.schema,accountability:e.accountability}),n=e.params.file;r.readByQuery({fields:["*"],filter:{filename_download:{_eq:n}}}).then((async e=>{console.log("press-releases results: ",e);const t=`/tmp/${n}`,l=`/assets/${e[0].id}`;return await o(t,`http://localhost:8055${l}`),s.sendFile(t)})).catch((e=>t(new c(e.message))))}))};
