"use strict";const e=require("node-fetch"),t=require("fs"),s=async(s,i)=>{let r=((e,s)=>new Promise(((i,r)=>{const a=t.createWriteStream(s);e.pipe(a).on("finish",i).on("error",r)})))((await e(i)).body,s);return r};module.exports=(e,{services:t,exceptions:i})=>{const{ItemsService:r}=t,{ServiceUnavailableException:a}=i;e.get("/:file",((e,t,i)=>{const c=new r("directus_files",{schema:e.schema,accountability:e.accountability}),n=e.params.file;c.readByQuery({fields:["*"],filter:{filename_download:{_eq:n}}}).then((async e=>{const i=`/tmp/${n}`,r=`/assets/${e[0].id}`;return await s(i,`https://dev-onrr-cms.app.cloud.gov${r}`),t.sendFile(i)})).catch((e=>i(new a(e.message))))}))};
