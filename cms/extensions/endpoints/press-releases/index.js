"use strict";const e=require("node-fetch"),s=require("fs"),o="https://dev-onrr-cms.app.cloud.gov";console.log("press-release targetUrl ----------------------\x3e ",o);const t=async(o,t)=>{console.log("------------------------------------------------------------------------------------"),console.log("                                                                    "),console.log("url:  ",t),console.log("                                                                    "),console.log("------------------------------------------------------------------------------------");let r=((e,o)=>new Promise(((t,r)=>{const c=s.createWriteStream(o);e.pipe(c).on("finish",t).on("error",r)})))((await e(t)).body,o);return r};module.exports=(e,{services:s,exceptions:r})=>{const{ItemsService:c}=s,{ServiceUnavailableException:l}=r;e.get("/:file",((e,s,r)=>{const n=new c("directus_files",{schema:e.schema,accountability:e.accountability}),a=e.params.file;n.readByQuery({fields:["*"],filter:{filename_download:{_eq:a}}}).then((async e=>{console.log("press-releases results: ",e);const r=`/tmp/${a}`,c=`/assets/${e[0].id}`;return await t(r,`${o}${c}`),s.sendFile(r)})).catch((e=>r(new l(e.message))))}))};
