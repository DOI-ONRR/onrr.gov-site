"use strict";const e=require("node-fetch"),o=require("fs"),s=async(s,t)=>{console.log("------------------------------------------------------------------------------------"),console.log("                                                                    "),console.log("url:  ",t),console.log("                                                                    "),console.log("------------------------------------------------------------------------------------");let c=((e,s)=>new Promise(((t,c)=>{const n=o.createWriteStream(s);e.pipe(n).on("finish",t).on("error",c)})))((await e(t)).body,s);return c};module.exports=(e,{services:o,exceptions:t})=>{const{ItemsService:c}=o,{ServiceUnavailableException:n}=t;e.get("/:file",((e,o,t)=>{console.log("router.get req, res, next: ",e,o,t);const r=new c("links",{schema:e.schema,accountability:e.accountability}),l=e.params.file;r.readByQuery({fields:["*"],filter:{target:{_eq:l}}}).then((async e=>{console.log("results: ",e);const t="/tmp/"+l,c="/assets/"+e[0].directus_files_id;return await s(t,"http://localhost:8055"+c),o.sendFile(t)})).catch((e=>t(new n(e.message))))}))};
