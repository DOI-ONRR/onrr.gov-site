"use strict";const e=require("node-fetch"),o=require("fs"),s=async(s,t)=>{console.log("------------------------------------------------------------------------------------"),console.log("                                                                    "),console.log("url:  ",t),console.log("                                                                    "),console.log("------------------------------------------------------------------------------------");let c=((e,s)=>new Promise(((t,c)=>{const n=o.createWriteStream(s);e.pipe(n).on("finish",t).on("error",c)})))((await e(t)).body,s);return c};module.exports=(e,{services:o,exceptions:t})=>{const{ItemsService:c}=o,{ServiceUnavailableException:n}=t;e.get("/:file",((e,o,t)=>{const r=new c("links",{schema:e.schema,accountability:e.accountability}),i=e.params.file;r.readByQuery({fields:["*"],filter:{target:{_eq:i}}}).then((async e=>{const t="/tmp/"+i,c="/assets/"+e[0].directus_files_id;return await s(t,"https://dev-onrr-cms.app.cloud.gov"+c),o.download(t)})).catch((e=>t(new n(e.message))))}))};
