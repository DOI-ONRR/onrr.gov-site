"use strict";const e=require("node-fetch"),o=require("fs"),s=async(s,t)=>{console.log("------------------------------------------------------------------------------------"),console.log("                                                                    "),console.log("url:  ",t),console.log("                                                                    "),console.log("------------------------------------------------------------------------------------");let c=((e,s)=>new Promise(((t,c)=>{const n=o.createWriteStream(s);e.pipe(n).on("finish",t).on("error",c)})))((await e(t)).body,s);return c};module.exports=(e,{services:o,exceptions:t})=>{const{ItemsService:c}=o,{ServiceUnavailableException:n}=t;e.get("/:file",((e,o,t)=>{const l=new c("directus_files",{schema:e.schema,accountability:e.accountability}),a=e.params.file;l.readByQuery({fields:["*"],filter:{filename_download:{_eq:a}}}).then((async t=>{const c="/tmp/"+a,n="localhost"===e.hostname?"localhost:8055":e.hostname,l=e.protocol+"://"+n+"/assets/"+t[0].id;return console.debug("REQ -----\x3e",e),console.debug("URL -----\x3e",l),await s(c,l),o.sendFile(c)})).catch((e=>t(new n(e.message))))}))};
